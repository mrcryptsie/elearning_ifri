{% extends 'base.html' %}
{% block title %}Gestion du programme - {{ course.name }}{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    .edit-course-page { font-family: 'Montserrat', sans-serif; background-color: #f8f9fa; min-height: 90vh; }
    .sidebar-card { border: none; border-radius: 20px; position: sticky; top: 20px; }
    .lesson-item { 
        border: none; 
        border-radius: 15px; 
        background-color: white; 
        transition: all 0.2s; 
        border-left: 5px solid #e0e0e0;
    }
    .lesson-item:hover { border-left-color: #0057A8; transform: translateX(5px); }
    .order-badge { width: 30px; height: 30px; background: #f1f1f1; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8rem; }
</style>

<div class="edit-course-page py-5">
    <div class="container">
        <div class="mb-4">
            <a href="{% url 'trainer_course_list' %}" class="text-success text-decoration-none">
                <i class="fas fa-arrow-left me-2"></i> Retour à mes formations
            </a>
        </div>

        <div class="row">
            <div class="col-lg-4 mb-4">
                <div class="card sidebar-card shadow-sm p-4">
                    <h5 class="fw-bold mb-4 text-success"><i class="fas fa-info-circle me-2"></i>Infos Générales</h5>
                    <form method="POST">
                        {% csrf_token %}
                        {% for field in form %}
                        <div class="mb-3">
                            <label class="small fw-bold text-uppercase text-muted" style="font-size: 0.7rem;">{{ field.label }}</label>
                            {{ field }}
                        </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-success w-100 rounded-pill fw-bold mt-3 shadow-sm">
                            Mettre à jour le cours
                        </button>
                    </form>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h3 class="fw-bold mb-0">Programme de formation</h3>
                        <p class="text-muted small">{{ lessons.count }} modules enregistrés</p>
                    </div>
                    <a href="{% url 'trainer_lesson_add' course.id %}" class="btn btn-primary rounded-pill px-4 shadow-sm">
                        <i class="fas fa-plus me-2"></i> Ajouter une leçon
                    </a>
                </div>

                {% for lesson in lessons %}
                <div class="lesson-item shadow-sm p-3 mb-3 d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center gap-3">
                        <div class="order-badge">{{ lesson.order }}</div>
                        <div>
                            <h6 class="fw-bold mb-1">{{ lesson.title }}</h6>
                            <div class="d-flex gap-2">
                                {% if lesson.content_text %}<span class="badge bg-light text-muted border small" style="font-size: 0.6rem;">TEXTE</span>{% endif %}
                                {% if lesson.pdf_file %}<span class="badge bg-danger-subtle text-danger border-0 small" style="font-size: 0.6rem;">PDF</span>{% endif %}
                                {% if lesson.quizzes.exists %}<span class="badge bg-primary-subtle text-primary border-0 small" style="font-size: 0.6rem;">{{ lesson.quizzes.count }} QUIZ</span>{% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="{% url 'trainer_lesson_edit' lesson.id %}" class="btn btn-sm btn-outline-dark rounded-pill px-3">
                            <i class="fas fa-pen me-1"></i> Contenu
                        </a>
                        <a href="{% url 'trainer_quiz_create' %}?lesson={{ lesson.id }}" class="btn btn-sm btn-success rounded-pill px-3">
                            <i class="fas fa-question-circle me-1"></i> + Quiz
                        </a>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-5 bg-white rounded-4 border-2 border-dashed">
                    <i class="fas fa-book-open fa-3x text-muted mb-3 opacity-25"></i>
                    <h5 class="text-muted">Votre programme est vide</h5>
                    <p class="small text-muted mb-4">Commencez par ajouter votre premier module de cours.</p>
                    <a href="{% url 'trainer_lesson_add' course.id %}" class="btn btn-primary rounded-pill px-4">
                        Créer la première leçon
                    </a>
                </div>
                {% endfor %}

                <div class="card border-0 bg-success text-white rounded-4 p-4 mt-5 shadow-lg">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="fw-bold mb-1"><i class="fas fa-certificate me-2"></i> Certification finale</h5>
                            <p class="mb-0 small opacity-75">Le certificat sera généré automatiquement pour les élèves ayant 100% de réussite.</p>
                        </div>
                        <i class="fas fa-award fa-3x opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}